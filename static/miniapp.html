<!DOCTYPE html>
<html lang="uz">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Premium obuna</title>

  <script src="https://telegram.org/js/telegram-web-app.js"></script>

  <style>
    :root {
      --bg: var(--tg-theme-bg-color, #ffffff);
      --text: var(--tg-theme-text-color, #111111);
      --secondary: var(--tg-theme-secondary-bg-color, #f3f4f6);
      --accent: #2f80ff;
    }

    * {
      box-sizing: border-box;
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
    }

    body {
      margin: 0;
      background: var(--bg);
      color: var(--text);
    }

    .container {
      padding: 20px;
    }

    h1 {
      font-size: 22px;
      font-weight: 700;
      margin-bottom: 6px;
    }

    .subtitle {
      font-size: 14px;
      opacity: 0.7;
      margin-bottom: 20px;
    }

    /* ===== PRICING ===== */

    .pricing-grid {
      display: flex;
      flex-direction: column;
      gap: 14px;
    }

    .plan {
      position: relative;
      background: var(--secondary);
      border-radius: 16px;
      padding: 16px;
      border: 2px solid transparent;
      cursor: pointer;
      transition: all 0.25s ease;
    }

    .plan.active {
      border-color: var(--accent);
      box-shadow: 0 0 0 2px rgba(47, 128, 255, 0.15);
    }

    .plan-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .plan-header h2 {
      margin: 0;
      font-size: 18px;
    }

    .plan-tag {
      font-size: 12px;
      opacity: 0.6;
    }

    .price {
      font-size: 20px;
      font-weight: 700;
      margin-top: 8px;
    }

    .per {
      font-size: 13px;
      opacity: 0.7;
    }

    .save {
      font-size: 13px;
      margin-top: 6px;
      color: var(--accent);
    }

    .badge {
      position: absolute;
      top: -10px;
      right: 12px;
      background: var(--accent);
      color: #fff;
      font-size: 11px;
      padding: 4px 8px;
      border-radius: 10px;
    }

    .cta {
      margin-top: 22px;
      width: 100%;
      padding: 14px;
      font-size: 16px;
      font-weight: 600;
      border-radius: 14px;
      border: none;
      background: var(--accent);
      color: #fff;
      cursor: pointer;
    }

    .note {
      margin-top: 12px;
      font-size: 12px;
      opacity: 0.6;
      text-align: center;
    }

    /* ===== PAYMENT PAGE ===== */

    #payment-page {
      display: none;
    }

    .card-box {
      background: var(--secondary);
      border-radius: 14px;
      padding: 14px;
      margin: 16px 0;
      font-size: 16px;
      font-weight: 600;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .copy-btn {
      font-size: 13px;
      color: var(--accent);
      cursor: pointer;
    }

    .back {
      margin-top: 16px;
      font-size: 14px;
      color: var(--accent);
      text-align: center;
      cursor: pointer;
    }
  </style>
</head>

<body>
<div class="container">

  <!-- ===== PRICING PAGE ===== -->
  <div id="pricing-page">
    <h1>Premium obuna</h1>
    <div class="subtitle">
      Avtomatik e’lon joylash orqali ko‘proq buyurtma va kamroq vaqt
    </div>

    <div class="pricing-grid">
      <div class="plan" onclick="selectTariff(this, 1, 35000)">
        <div class="plan-header">
          <h2>1 oy</h2>
          <span class="plan-tag">Sinab ko‘rish</span>
        </div>
        <div class="price">35 000 so‘m</div>
        <div class="per">1 oy = 35 000 so‘m</div>
      </div>

      <div class="plan active" onclick="selectTariff(this, 6, 170000)">
        <div class="badge">Eng mashhur</div>
        <div class="plan-header">
          <h2>6 oy</h2>
          <span class="plan-tag">Tavsiya qilinadi</span>
        </div>
        <div class="price">170 000 so‘m</div>
        <div class="per">1 oy ≈ 28 300 so‘m</div>
        <div class="save">≈ 40 000 so‘m tejaysiz</div>
      </div>

      <div class="plan" onclick="selectTariff(this, 12, 360000)">
        <div class="plan-header">
          <h2>12 oy</h2>
          <span class="plan-tag">Eng tejamkor</span>
        </div>
        <div class="price">360 000 so‘m</div>
        <div class="per">1 oy = 30 000 so‘m</div>
        <div class="save">Maksimal foyda</div>
      </div>
    </div>

    <button class="cta" onclick="goToPayment()">To‘lovga o‘tish</button>
    <div class="note">Xavfsiz • Qo‘lda tekshiriladi • Telegram qoidalariga mos</div>
  </div>

  <!-- ===== PAYMENT PAGE ===== -->
  <div id="payment-page">
    <h1>To‘lov qilish</h1>
    <div class="subtitle">
      Quyidagi karta raqamiga to‘lov qiling va chekni adminga yuboring
    </div>

    <div class="card-box">
      <span id="card-number">8600 12XX XXXX XXXX</span>
      <span class="copy-btn" onclick="copyCard()">Nusxalash</span>
    </div>

    <button class="cta" onclick="sendReceipt()">Chekni yuborish</button>

    <div class="back" onclick="goBack()">← Tariflarga qaytish</div>
  </div>

</div>

<script>
  const tg = Telegram.WebApp;
  tg.ready();

  let selected = {
    months: 6,
    price: 170000,
    tariff: "6 oy"
  };

  function selectTariff(el, months, price) {
    document.querySelectorAll(".plan").forEach(p => p.classList.remove("active"));
    el.classList.add("active");

    selected = {
      months,
      price,
      tariff: months + " oy"
    };
  }

  function goToPayment() {
    document.getElementById("pricing-page").style.display = "none";
    document.getElementById("payment-page").style.display = "block";
  }

  function goBack() {
    document.getElementById("payment-page").style.display = "none";
    document.getElementById("pricing-page").style.display = "block";
  }

  function copyCard() {
    navigator.clipboard.writeText("8600123412341234");
    tg.showPopup({ message: "Karta raqami nusxalandi" });
  }

  async function sendReceipt() {
    const user = tg.initDataUnsafe.user;

    await fetch("/api/payment/init", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({
        user_id: user.id,
        months: selected.months,
        amount: selected.price,
        tariff: selected.tariff
      })
    });

    tg.openTelegramLink("https://t.me/Haydovchiadminbot");

    <script>
Telegram.WebApp.ready();

function openGroupsPage() {
  document.getElementById("groups-page").style.display = "block";
  loadGroups();
}

async function loadGroups() {
  const res = await fetch("/api/get-user-dialogs");
  const groups = await res.json();

  const list = document.getElementById("groups-list");
  list.innerHTML = "";

  groups.forEach(g => {
    const div = document.createElement("div");
    div.innerHTML = `
      <label>
        <input type="checkbox" value="${g.id}">
        ${g.title}
      </label>
    `;
    list.appendChild(div);
  });
}

function saveSelectedGroups() {
  const checked = [...document.querySelectorAll("#groups-list input:checked")]
    .map(i => ({
      id: Number(i.value),
      title: i.parentElement.textContent.trim()
    }));

  fetch("/api/save-groups", {
    method: "POST",
    headers: {"Content-Type": "application/json"},
    body: JSON.stringify({
      user_id: Telegram.WebApp.initDataUnsafe.user.id,
      groups: checked
    })
  }).then(() => {
    Telegram.WebApp.showPopup({ message: "✅ Guruhlar saqlandi" });
    Telegram.WebApp.close();
  });
}
</script>

  }
</script>

</body>
</html>
